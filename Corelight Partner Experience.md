# Corelight Partner Experience

> [Splunk Server](https://corelight.splunk.show)
>
> User ID: user001-splk
>
> Password: Splunk.5

- [Corelight Partner Experience](#corelight-partner-experience)
  - [Scenario 1 - Corelight Trickbot CTF](#scenario-1---corelight-trickbot-ctf)
    - [101](#101)
    - [102](#102)
    - [103](#103)
    - [104](#104)
    - [105](#105)
    - [106](#106)
    - [107](#107)
    - [108](#108)
    - [109](#109)
    - [110](#110)
    - [111](#111)
    - [112](#112)
    - [113](#113)
    - [114](#114)
    - [115](#115)
    - [116](#116)
    - [117](#117)
    - [118](#118)
    - [119](#119)
    - [120](#120)
    - [121](#121)
    - [122](#122)
  - [Scenario 2](#scenario-2)
    - [201](#201)
    - [202](#202)
    - [203](#203)
    - [204](#204)
    - [205](#205)
    - [206](#206)
    - [207](#207)
    - [208](#208)
    - [209](#209)
    - [210](#210)
    - [211](#211)

## Scenario 1 - Corelight Trickbot CTF

> Use `index=corelight` for this challenge

### 101

How many total Suricata alerts were generated in this index?

> 47

```splunk
index=corelight sourcetype=corelight_suricata_corelight | stats dc(suri_id)
```

- Did a distinct count on the suricate IDs which are unique to each event

---

### 102

Most of the alerts are being generated by a single source host. What is its IP address?

> 10.0.0.31

```splunk
index=corelight sourcetype=corelight_suricata_corelight | stats count by id_orig_h
```

| id_orig_h | count |
| --------- | ----- |
| 10.0.0.31 | 46    |
| 10.0.0.51 | 1     |

- Table command of the origin address

---

### 103

What's the name of the malware family identified by these alerts?

> Trickbot

```splunk
index=corelight sourcetype=corelight_suricata_corelight | table alert.signature | dedup alert.signature
```

| alert.signature                                                                                   | count |
| ------------------------------------------------------------------------------------------------- | ----- |
| ET DOS Possible NTP DDoS Inbound Frequent Un-Authed MON_LIST Requests IMPL 0x03                   | 1     |
| ET DOS Possible SSDP Amplification Scan in Progress                                               | 1     |
| ET HUNTING GENERIC SUSPICIOUS POST to Dotted Quad with Fake Browser 1                             | 8     |
| ET HUNTING Suspicious POST with Common Windows Process Names - Possible Process List Exfiltration | 4     |
| ET MALWARE Win32/Trickbot Data Exfiltration                                                       | 4     |
| ET POLICY External IP Lookup (ipify .org)                                                         | 1     |
| ET POLICY HTTP traffic on port 443 (POST)                                                         | 12    |
| ET POLICY OpenSSL Demo CA - Internet Widgits Pty (O)                                              | 1     |
| ET POLICY Signed TLS Certificate with md5WithRSAEncryption                                        | 2     |
| ET POLICY Spotify P2P Client                                                                      | 1     |
| ET POLICY curl User-Agent Outbound                                                                | 1     |
| ET SCAN Behavioral Unusual Port 135 traffic Potential Scan or Infection                           | 1     |
| ET SCAN Behavioral Unusual Port 139 traffic Potential Scan or Infection                           | 1     |
| ET SCAN Behavioral Unusual Port 1433 traffic Potential Scan or Infection                          | 1     |
| ET SCAN Behavioral Unusual Port 1434 traffic Potential Scan or Infection                          | 1     |
| ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection                           | 1     |
| ETPRO EXPLOIT Possible Asus WRT LAN Backdoor Command Execution                                    | 1     |
| ETPRO SCAN Nessus Scanner UPNP Broadcast                                                          | 1     |
| GPL ATTACK_RESPONSE command completed                                                             | 4     |

- table of the alert signatures present and looked for an alert relating to malware

---

### 104

Let's take a closer look at the `"ET MALWARE Win32/Trickbot Data Exfiltration"` alerts. You'll notice that three of the alerts share a single UID, meaning they all occured on a single TCP stream. What is that UID?

> CAoNRI62m9CRqS0R2

```splunk
index=corelight sourcetype=corelight_suricata_corelight alert.signature="ET MALWARE Win32/Trickbot Data Exfiltration" | stats count by uid
```

| uid                | count |
| ------------------ | ----- |
| CAoNRI62m9CRqS0R2  | 3     |
| CAxYSR26jP6LeD4z1e | 1     |

---

### 105

What is the IP address of the malicious server involved in the alerts for this stream?

> 103.16.104.83

```splunk
index=corelight sourcetype=corelight_suricata_corelight alert.signature="ET MALWARE Win32/Trickbot Data Exfiltration" uid=CAoNRI62m9CRqS0R2 | stats count by id.resp_h
```

---

### 106

What layer 7 protocol is the traffic in the previous question flowing over that generates the alerts?

> http

```splunk
index=corelight sourcetype=corelight_suricata_corelight alert.signature="ET MALWARE Win32/Trickbot Data Exfiltration" uid=CAoNRI62m9CRqS0R2 | stats count by service
```

---

### 107

Taking the UID mentioned in the previous question and searching for it across the index, we see that a corelight_notice log was also generated. What is the number of the MITRE ATT&CK TTP referenced in the notice?

> S0266

```splunk
index=corelight sourcetype=corelight_notice uid=CAoNRI62m9CRqS0R2 | table msg
```

---

### 108

What User-Agent string was sent as part of the Trickbot HTTP requests?

> Ghost

```splunk
index=corelight uid=CAoNRI62m9CRqS0R2 source="http:corelight" user_agent=* | stats count by user_agent
```

- Using the UID previously to search across the http logs and find the user agent

---

### 109

What is a process name that is repeated within the POST body of these HTTP requests?

> svchost.exe

```splunk
index=corelight uid=CAoNRI62m9CRqS0R2 post_body=* | table post_body | dedup post_body
```

- Description

---

### 110

Let's look at what happened after the malware was dropped. Looking at Suricata alerts following the Trickbot alert, a popular scanning tool appears to have been used for reconnaissance. What is the name of that tool?

> nessus

```splunk
index=corelight sourcetype=corelight_suricata_corelight | table alert.signature | dedup alert.signature
```

Table of results/output

- Looked for alert type focused around scanning

---

### 111

One of the alerts generated by our infected host could result in command execution on a wireless access point. Looking at the response from the remote system, however, it's pretty clear that the attack failed. How many bytes did the target send back to the attacker on this connection?

> 0

```splunk
index=corelight uid=ChGTlJ1zd2PRktosx5 resp_ip_bytes=* | table resp_ip_bytes
```

Table of results/output

- Once you find the alert, search across the index using the UID from the alert to see conn logs, you can then find the bytes fields and see accordingly - note if it failed as well, it probably wouldn't send data back

---

### 112

Looking at the layer 7 services used by the infected host after the Trickbot alerts above, we see an SSH connection made to an internal host. What is the IP address of that host?

> 10.0.0.72

```splunk
index=corelight sourcetype=corelight_conn "id.resp_p"=22 "id.orig_h"="10.0.0.31" conn_state_desc="Normal establishment and termination." | table _time id.resp_h
```

Table of results/output

- Description

---

### 113

What is the PCR (producer/consumer ratio) of that SSH session?

> -0.99593

```splunk
index=corelight sourcetype=corelight_conn "id.resp_p"=22 "id.orig_h"="10.0.0.31" conn_state_desc="Normal establishment and termination."  "id.resp_h"="10.0.0.72" | eval PCR=round(pcr,5) | table PCR
```

| PCR      |
| -------- |
| -0.99593 |

---

### 114

Examining the inferences section of the SSH log associated with that session, one code indicates a behavior that explains the PCR we just observed. Which code is it?

> LFD

```splunk
Used SSH Inference Dashboard and searched via UID
```

Table of results/output

- Honestly I winged it out of the 3 and got it right, will try figure out why exactly

---

### 115

The owner of the infected workstation had no credentials to log into 10.0.0.72 over SSH. However, there was another connection between those hosts over HTTP. What attack type was sent over that connection?

> SQL Injection

```splunk
index="corelight" sourcetype=corelight_http "id.orig_h"="10.0.0.31" "id.resp_h"="10.0.0.72" | table uri
```

| uri                                                                                                                                          |
| -------------------------------------------------------------------------------------------------------------------------------------------- |
| /mutillidae/index.php?page=user-info.php&username=admin'+or+1=1+#&password=adfadf&user-info-php-submit-button=View+Account+Details           |
| /mutillidae/index.php?page=user-info.php&username='"@`%>![]\*$;:?^<.{}+-=~\#&password=afadf&user-info-php-submit-button=View+Account+Details |

---

### 116

What parameter of the index.php script did the infected system attempt to use for SQL injection?

> ?page=user-info.php&username

- Grab from previous answer

---

### 117

What was the HTTP status code from the targeted server?

> 200

```splunk
index="corelight" sourcetype=corelight_http "id.orig_h"="10.0.0.31" "id.resp_h"="10.0.0.72" index.php | table status_code
```

- Can view in just the events column or table it

---

### 118

Did this SQL injection attack generate any Suricata alerts? (Yes/No)

> No

- changed time +/- 5 seconds and look for suricata signatures

---

### 119

Returning to SSH connections made by our infected host, we see a second one being made to a country the organization has no business relationship with. What country is that connection going to?

> Thailand

```splunk
index="corelight" sourcetype=corelight_conn "id.orig_h"="10.0.0.31" action=allowed dest_port=22 resp_cc=TH
```

---

### 120

Judging by the PCR (producer/consumer ratio) of this connection, data was definitely exfiltrated to this external system. What is the SSH host key of that system?

> 1c:6e:58:a2:57:98:33:f4:53:e8:63:46:df:a2:31:ef

```splunk
Same dashboard -
```

![Alt text](image.png)

---

### 121

How many payload bytes were sent over that connection?

> 128105745

```splunk
index="corelight" sourcetype=corelight_conn "id.orig_h"="10.0.0.31" action=allowed dest_port=22 resp_cc=TH | table orig_bytes
```

---

### 122

The challenge author's favorite SSL certificate organization name - a default out of many certificate generation tools - is present in this index, highlighted by a Suricata alert. What is that organization name?

> Internet Widgits Pty Ltd

```splunk
index="corelight" sourcetype="corelight_suricata_corelight"  "alert.signature"="ET POLICY OpenSSL Demo CA - Internet Widgits Pty (O)"

index="corelight" CxAsok2xLkCyAoxiy6 | table ssl_issuer
```

- Initially I grabbed the alert signature around SSL and used the UID to cast a broader search, once I identified useful fields, I tabled the information and was presented the answer

---

## Scenario 2

> Corelight Zeek and Suricata CTF

> [Splunk Server](https://corelight.splunk.show)
>
> User ID: user001-splk
>
> Password: Splunk.5

### 201

An HTTP request is made to a specific PHP page. What is the filename of that page (excluding any path or slashes)?

> /whoami.php

```splunk
index=ctf sourcetype=corelight_http *php*
```

- Check the URI in the events

---

### 202

What is the IP address that only appears once as the server for the three connections in the previous question?

> 66.228.32.31

```splunk
index=ctf sourcetype=corelight_http *php* | stats count by id.orig_h id.resp_h
```

| id.orig_h   | id.resp_h        | count |
| ----------- | ---------------- | ----- |
| 10.9.18.101 | 104.236.185.25   | 2     |
| 10.9.18.101 | **66.228.32.31** | 1     |

- Can manually verify by looking at the response header for the events or use stats to perform the count for you

---

### 203

What is the IP address that mail.ventascintas.com resolved to?

> 142.4.4.112

```splunk
index=ctf sourcetype=corelight_dns mail.ventascintas.com
```

- Look in the `answers` dropdown in th event and you will get the IP

---

### 204

What is the domain associated with an X.509 certificate subject that purports to be from London?

> example.com

```splunk
index=ctf sourcetype=corelight_x509 london | table certificate.issuer | dedup certificate.issuer
```

| certificate.issuer                                                        |
| ------------------------------------------------------------------------- |
| CN=example.com,OU=IT Department,O=Global Security,L=London,ST=London,C=GB |

- CN is the certificate name and will be the associated Domain in question

---

### 205

What cipher suite was used with the certificate from the prior question?

> TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA

```splunk
index=ctf sourcetype=corelight_ssl *example.com* | table cipher
```

| cipher                             |
| ---------------------------------- |
| TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA |

- looking through the ssl logs with the domain we found from the previous question gets us the answer, nice table to view the data

---

### 206

There is a unique JA3 hash associated with certificate from the previous question. What is that hash?

> 35492f143de0f906215ea3aaf6ee0a74

- Using the same search you can just find the field for JA3 hash in the events view

---

### 207

What was the matching JA3S hash associated with the JA3 hash identified in the previous question?

> 623de93db17d313345d7ea481e7443cf

- Find it in the same place you found the JA3 hash

---

### 208

What department does that certificate from question 204 allegedly correspond to?

> IT Department

```splunk
index=ctf sourcetype=corelight_x509 london
```

| certificate.issuer                                                            |
| ----------------------------------------------------------------------------- |
| CN=example.com,OU=**IT Department**,O=Global Security,L=London,ST=London,C=GB |

---

### 209

What is the SHA1 of the most recent X.509 certificate from question 204?

> 19594b811f9f867db68efabcc7135852e63fd7da

```splunk
index=ctf FNZ7Z22WzAofFQvsZf | table sha1
```

- Initially I sorted the events by `- _time` to get the most recent at the top, I then searched across all sourcetypes with the `fuid` found from the most recent event. This then took us to discover the files sourcetype which has a `sha1` field.

---

### 210

An executable was downloaded from 124.158.6.218. What was the name of that executable?

> i5pv72yr.exe

```splunk
index=ctf sourcetype=corelight_files 124.158.6.218 | table filename
```

| Filename     |
| ------------ |
| i5pv72yr.exe |

- Search through corelight files for entries with that IP and bob's ya uncle

---

### 211

As part of this traffic, there were two executables downloaded from 104.168.98.206. What is the SHA1 of the most recently downloaded executable?

> fdd0480a69d17d33292733668c6fd1dedf453a3c

```splunk
index=ctf sourcetype=corelight_files 104.168.98.206
```

- First event that shows and find the SHA1 field

---

<!-- QUESTION AND ANSWER TEMPLATE
###

>Flag

```splunk

```

Table of results/output

- Description

---

-->
